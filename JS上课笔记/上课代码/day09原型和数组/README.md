# 第九天

## 构造函数（constructor）

- 构造函数（类）是专门用来创建对象的函数。

- 构造函数就是一个普通函数，一个函数如果直接调用那么它就是一个普通函数，如果通过new关键字调用那么它就是一个构造函数

- 一个构造函数也称为一个类，通过该构造函数创建的对象，称对象为该类实例。通过同一个构造函数创建的对象，称为一类对象。

  - 普通函数

    - ```javascript
      fn(); //普通函数
      ```

  - 构造函数

    - ```javascript
      new fn(); //构造函数
      ```

- 构造函数的执行的流程：

  1. 构造执行时，会先创建一个新的对象
  2. 将新的对象设置为函数中的this
  3. 逐行执行函数中的代码
  4. 将新的对象作为返回值返回

- this到底是谁？

  - 以函数形式调用函数时，this是window
  - 以方法形式调用函数时，this是调用方法的对象
  - 以构造函数形式调用函数时，this是新创建的对象
  - 未完，待续……

## 原型（prototype）

- JS是一门面向对象的高级语言，它的面向对象是基于原型

- 在函数对象都存在一个属性prototype，该属性指向了一个对象，这个对象就是原型对象。

- 如果函数作为一个普通函数调用这个prototype没有任何作用。

- 如果函数作为一个构造函数调用时，则它所创建的所有实例中都会有一个隐含的属性（\_\_proto\_\_）指向该对象（实例的隐式原型指向构造函数的显示原型）

- 所以原型对象就相当于所有实例的一个公共区域，可以将对象中共有属性（方法）统一设置在原型对象中，这样我们只需设置一次即可让所有的实例都具有这些属性（方法）。

- 创建构造函数（类）时，将独有的属性在函数内部通过this来设置，将共有的属性在函数外部通过原型来设置。

  - 例子：

  - ```javascript
    function MyClass(name,age){
    	this.name = name;
    	this.age = age;
    }
    MyClass.prototype.xxx = xxx;
    MyClass.prototype.yyy = function(){};
    ```

- 原型链：

  - 在访问一个对象的属性时，JS解析器会先在对象本身中寻找，如果找到了，则直接使用。如果没有找到则到对象的原型中寻找，找到了则使用。没有找到则去原型的原型中寻找，以此类推。直到找到Object的原型，它是所有对象原型，如果依然没有找到，则返回undefined。
  - 访问属性时，会沿着对象的原型链搜索，搜索不到不会报错，而是返回undefined。
  - 访问变量时，会沿着作用域链搜索，搜索不到会报错。

- 补充运算符和方法：

  - in 运算符

    - 检查一个对象中是否含有某个属性（原型中含有该属性，也会返回true）

    - ```javascript
      'name' in obj // '属性名' in 对象
      ```

  - instanceof 运算符

    - 检查一个对象是否是某个类的实例（原型链上有该类的实例就会返回true）

    - ```javascript
      obj instanceof Object // 对象 instanceof 构造函数
      ```

  - hasOwnProperty()

    - 检查一个对象自身是否含有某个属性

    - ```javascript
      obj.hasOwnProperty('name') //对象.hasOwnProperty(属性名)
      ```

- toString()

  - 当打印一个对象时，浏览器会自动调用对象的toString()将对象转换为字符串，然后再进行打印。
  - 所以当打印一个对象时，实际上打印的是对象的toString()方法的返回值。
  - 可以通过重写toString()来改变打印对象时的输出的结果。

## 垃圾回收（GC）

- 在编程语言中，不被任何变量或属性引用的对象（不可达对象）被称为垃圾对象。垃圾对象我们无法访问，但依然会占据内存空间。所以必须对垃圾对象进行及时的清理，才能确保程序运行速度不会变慢。
- JS中拥有自动的垃圾回收机制，我们不需要手动回收，只需要将不再使用的变量设置为null即可。
- 垃圾的回收的常见方式：
  - 引用计数
    - 引用计数会带来循环引用的问题，导致一些垃圾不能被正确的回收。
  - 标记清除
    - 标记清除需要遍历所有的对象，所以它的性能会比较差
  - 分代收集
    - 将对象分成两代或三代，一代表示新创建的对象，二代和三代表示老的对象
    - 一代对象检查的频率最高，二代对象次之，三代最少

## 数组（Array）

- 数组也是一个对象，用来存储一组有序的数据

- 数组中存储的数据被称为元素，在数组中通过索引来操作元素

- 索引（index）指的是一组从0开始的整数

- JS中的数组没有大小限制，在数组中可以存储任意类型任意数量的元素

- 存储大量数据时，数组的性能会高于普通的对象

- 数组的使用：

  - 创建数组：

  - ```javascript
    var arr = new Array(); // 通过构造函数创建一个数组
    arr = []; // 通过字面量创建一个数组
    arr = [3,2,1,4,5]; // 创建数组时直接指定数组中的元素
    arr= new Array(3,1,2,3); // 创建数组时直接指定数组中的元素
    arr = new Array(3); // 创建一个指定大小的数组
    ```

  - 向数组中添加元素：

  - ```javascript
    arr[0] = 33; // 向索引为0的位置添加一个元素 语法：数组[索引] = 值;
    ```

  - 删除数组中的元素：

  - ```javascript
    delete arr[0]; // 删除数组中索引为0的元素 语法：delete 数组[索引]
    ```

  - 读取元素：

  - ```javascript
    arr[1]; // 读取索引为1的元素 语法：数组[索引] 读取一个不存在的元素时会返回undefined
    ```

  - 获取数组的长度（元素的个数）：

  - ```javascript
    arr.length // 获取数组的长度（最大索引 + 1）
    ```

  - 修改数组的长度：

  - ```javascript
    arr.length = 3;
    ```

- 数组的遍历：

  - 数组遍历就是将数组中每一个元素都获取出来

  - 方式一：for循环（最传统，最灵活，兼容性也最好）

    - ```javascript
      for(var i=0; i<arr.length; i++){
      	arr[i];
      }
      ```

  - 方式二：for-in遍历

    - ```javascript
      for(var i in arr){
      	arr[i];
      }
      ```

  - 方式三：for-of遍历（老版本浏览器不支持）

    - ```
      for(var e of arr){
      	e;
      }
      ```

- typeof运算符
  - typeof用来检查一个值的类型
    - 检查一个数值时会返回 "number"
    - 检查一个字符串时会返回 "string"
    - 检查一个布尔值时会返回 "boolean"
    - 检查一个undefined时会返回"undefined"
    - 检查一个对象或null时会返回"object"
    - 检查一个函数时会返回"function"
    - 检查一个数组时会返回"object"
    - 其他对象都是返回"object"
    - 检查大整数时，返回"bigint"（了解）
    - 检查Symbol时，返回"symbol"（了解）

